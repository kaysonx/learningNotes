# 从0开始学架构 - 高扩展

### 可扩展架构的基本思想和模式

#### 基本思想

**拆！**

> 拆，就是将原本大一统的系统拆分成多个规模小的部分，扩展时只修改其中一部分即可，无须整个系统到处都改，通过这种方式来减少改动范围，降低改动风险

常见拆分思路：

<ul>
<li>
<p>面向流程拆分：将整个业务流程拆分为几个阶段，每个阶段作为一部分</p>
</li>
<li>
<p>面向服务拆分：将系统提供的服务拆分，每个服务作为一部分</p>
</li>
<li>
<p>面向功能拆分：将系统提供的功能拆分，每个功能作为一部分</p>
</li>
</ul>

范围区分：流程 > 服务 > 功能

这里的流程指的是数据/通信的流向 而不是业务流程



🌰 - 学生信息管理系统

面向流程拆分

-展示层 -> 业务层 -> 数据层 -> 存储层

面向服务拆分

-注册 登录 信息管理 安全设置

面向功能拆分

-注册服务：手机号注册 身份证注册 学生邮箱注册

-登录服务：手机号登录 身份证登录 邮箱登录



不同的拆分方式 本质上决定了系统的扩展方式

面向流程 - 修改某一层或关联的两层

面向服务 - 修改某一服务

面向功能 - 扩展相关功能



典型可扩展架构有：

面向流程拆分 - 分层架构

面向服务拆分 - SOA 微服务

面向功能拆分 - 微内核架构

一般在系统设计中进行组合使用



### 分层架构和SOA

#### 分层架构

根据不同的划分维度和对象，可以分类为：

1.C/S架构 B/S架构 - 划分的对象是整个业务系统 划分的维度是用户交互

2.MVP MVC架构 - 划分的对象是单个业务子系统 划分的维度是职责

3.逻辑分层架构 - 划分的对象可以是单个业务子系统 也可以是整个业务系统 划分的维度是职责，

逻辑分层架构中的层是自顶向下依赖的。而MVP MVC各层的依赖关系比较灵活

分层架构的核心是 需要保证各层之间的差异足够清晰，边界足够明显，让人看到架构图后就能看懂整个架构

分层的本质在于隔离关注点

另一个特点在于层层传递

#### SOA

出现的背景是 企业内部的IT系统重复建设切效率低下

关键概念：

1.服务 - 可大可小 需要对外提供开放的能力

2.ESB - enterprise service bus 用于连接不同的服务，屏蔽异构系统对外提供各种不同的接口方式 以此来达到服务间高效的互通互联

3.松耦合 

一般来说某个企业采用了SOA的架构来构建IT系统，而不会说某个系统采用了SOA架构

ESB的复杂度很高：实现各个系统间的协议和数据格式的解析 转换， 透明的动态路由等

且自身很容易成为瓶颈



SOA用于整合多个系统 而微服务是把单个系统拆分开，方向正好相反



### 微服务

微服务和SOA是不同的架构理念, 只是在服务这个点有交集

![img](/Users/qspeng/Documents/learningNotes/Architecture101/pics/MVSOA.png)

微服务的关键是：small lightweight automated

微服务的坑：

1. 服务划分过细 服务间关系复杂
2. 服务数量太多 团队效率急剧下降
3. 调用链太长 问题定位困难
4. 没有自动化支撑 无法快速交付
5. 没有服务治理 微服务数量多了后管理混乱



**良好实践**

服务粒度：

“三个火枪手” - 三个人负责一个微服务开发 来拆分



拆分方法：

1. 基于业务逻辑拆分
2. 基于可扩展拆分 - 稳定服务/变动服务
3. 基于可靠性拆分
   1. 避免非核心服务故障影响核心服务
   2. 核心服务高可用方案可以更简单
   3. 能够降低高可用成本
4. 基于性能拆分

一般是根据实际情况自由排列组合，应用上诉方法



基础设施：

![img](/Users/qspeng/Documents/learningNotes/Architecture101/pics/MB.png)

服务发现有两种实现方式 - 自理式和代理式

自理式 - 每个微服务自己完成服务发现 - spring cloud(eureka client)

代理式 - 微服务之间有一个负载均衡系统 由其完成服务之间的发现



1. 服务发现、服务路由、服务容错：这是最基本的微服务基础设施
2. 接口框架、API 网关：主要是为了提升开发效率，接口框架是提升内部服务的开发效率，API 网关是为了提升与外部服务对接的效率
3. 自动化部署、自动化测试、配置中心：主要是为了提升测试和运维效率
4. 服务监控、服务跟踪、服务安全：主要是为了进一步提升运维效率



### 微内核架构

也成为插件化架构 - 是一种面向功能进行拆分的可扩展性架构，通常实现于product-based应用(与web-based相对应)



例如Intelijj Eclipse等的插件



**基本架构**

包含 

核心系统 - 负责和具体业务功能无关的通用功能 例如模块加载 模块间通信

插件模块 - 负责具体的业务逻辑 



**设计关键点**

1. 插件管理 - 一般提供注册表以保存每个插件的信息
2. 插件连接 - 制定和核心系统的连接规范
   1. 常见的连接机制有 OSGi(Eclipse)、消息模式、依赖注入(Spring)
3. 插件通信



规则引擎从结构上也属于微内核架构的一种具体实现

常用的规则引擎 - JBoss Drools





















