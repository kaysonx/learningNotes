## 从0开始学架构 - 2

### 10 - 架构设计流程

**1.识别复杂度**

按之前的复杂度来源(高性能 高可用 高扩展 安全 成本(包含沟通成本) 等)，识别出软件系统的复杂性在哪儿

然后排出优先级

按优先级一个一个解决

> 没有什么是不能按照 分类 排优先级不能解决的
>
> 将主要的复杂度问题列出来，然后根据业务、技术、团队等综合情况进行排序，优先解决当前面临的最主要的复杂度问题

如何识别复杂度？

1.在理解需求的基础上进行分析 或者说 依据经验

2.若经验不足，采取“排查法”，从不同的角度逐一进行分析

>排查法：通过对系统进行各个复杂度维度的提问来分析是否存在此类复杂性
>
>比如：
>
>1. 这个消息队列是否需要高性能
>2. 这个消息队列是否需要高可用性
>3. 这个消息队列是否需要高扩展性
>4. ...

>对于架构师来说，常见系统的性能量级需要烂熟于心，例如nginx负载均衡性能是3万左右，mc的读取性能5万左右，kafka号称百万级，zookeeper写入读取2万以上，http请求访问大概在2万左右。
>具体的数值和机器配置以及测试案例有关，但大概的量级不会变化很大。
>
>如果是业务系统，由于业务复杂度差异很大，有的每秒500请求可能就是高性能了，因此需要针对业务进行性能测试，确立性能基线，方便后续架构设计做比较。

**2.设计备选方案**

推荐书籍：技术的本质

设计最终的方案容易犯的错误：

1. 设计最优秀的方案 - 应遵循合适原则和简单原则，在发展过程中演进
2. 只做一个方案 - 没有那个方案是完美的，需要多方评估
   1. 备选方案的数量以3~5个为最佳
   2. 备选方案的差异要比较明显<这里指的是架构上的差异 不是技术细节上的差异>
   3. 备选方案的技术不要只局限于已经熟悉的技术 - 讲视野放宽 考虑更多可能性
3. 备选方案过于详细
   1. 耗费时间精力
   2. 太细节 忽略了整体的技术设计
   3. 备选阶段关注的是技术选型

**3.评估和选择备选方案**

挑选最终方案的挑战在于：

1. 每个方案都是可行的 
2. 没有那个方案是完美的 都有其优点 缺点 
3. 评价标准主观性比较强

选取方案的指导思想：

1. 最简派 - 使用最简单的方案
2. 最牛派 - 使用技术上看起来最牛的方案
3. 最熟派 - 挑选自己最熟悉的方案
4. 领导派 - 自己拿捏不定 让领导来定夺

不同的场景应该采取不同的方式，所以所以判断场景？

— 360度环评

列出我们需要关注的质量属性点，然后分别从这些质量属性的维度去评估每个方案，再综合挑选适合当时情况的最优方案

> 常见的方案质量属性点有：性能、可用性、硬件成本、项目投入、复杂度、安全性、可扩展性等。在评估这些质量属性时，需要遵循架构设计原则 1.“合适原则”和原则 2.“简单原则”，避免贪大求全，基本上某个质量属性能够满足一定时期内业务发展就可以了

> 通常情况下，如果某个质量属性评估和业务发展有关系（例如，性能、硬件成本等），需要评估未来业务发展的规模时，一种简单的方式是将当前的业务规模乘以 2 ~4 即可，如果现在的基数较低，可以乘以 4；如果现在基数较高，可以乘以 2。例如，现在的 TPS 是 1000，则按照 TPS 4000 来设计方案；如果现在 TPS 是 10000，则按照 TPS 20000 来设计方案。

错误的选择方法：

1. 数量对比法 - 那种方案优点多就选择那个 忽略了质量属性的优先级
2. 加权法 - 给每个质量属性一个权重 权重比较主观，没有标准

正确的选择方法是： 按优先级选择

> 首先挑选满足第一优先级的，如果都满足，那就再看第二优先级...以此类推

**4.详细方案设计**

简单来说，详细方案设计就是将方案涉及的关键技术细节给确定下来

详细设计方案阶段可能遇到的一种极端情况就是在详细设计阶段发现备选方案不可行，一般情况下主要的原因是备选方案设计时遗漏了某个关键技术点或者关键的质量属性

为避免以上问题，有以下方式：

1. 架构师不但要进行备选方案设计和选型，还需要对备选方案的关键细节有较深入的理解
2. 通过分步骤、分阶段、分系统等方式，尽量降低方案复杂度
3. 如果方案本身就很复杂，那就采取<strong>设计团队</strong>的方式来进行设计，博采众长，汇集大家的智慧和经验，防止只有 1~2 个架构师可能出现的思维盲点或者经验盲区。







